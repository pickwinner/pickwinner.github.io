<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Comment Picker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ------------------- GLOBAL DESIGN ------------------- */
body {
  margin: 0;
  padding: 0;
  font-family: Inter, Arial, sans-serif;
  background: #1d82c5;   /* FULL BLUE BACKGROUND */
  color: #fff;
  text-align: center;
}

/* Container */
.container {
  width: 100%;
  max-width: 500px;
  margin: 0 auto;
  padding: 22px;
}

/* White Cards */
.box {
  background: #ffffff;
  padding: 18px;
  border-radius: 14px;
  margin-top: 18px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  color: #0f2b43;
  text-align: left;
}

/* Title inside card */
.boxTitle {
  font-size: 17px;
  font-weight: bold;
  margin-bottom: 10px;
}

/* Input */
input[type="text"] {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #c8d7e4;
  font-size: 15px;
  margin-top: 6px;
}

/* Checkbox Line */
.checkRow {
  margin-top: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 14px;
  color: #0f2b43;
}

input[type="checkbox"] {
  width: 18px;
  height: 18px;
}

/* Buttons BLUE + ROUND */
.bigBtn {
  width: 100%;
  background: #083b66;
  color: white;
  padding: 14px;
  border-radius: 30px;
  border: none;
  font-size: 18px;
  font-weight: bold;
  margin-top: 18px;
  cursor: pointer;
}

/* Comment Count */
.countBox {
  display: none;
  background: #ffffff;
  padding: 10px 18px;
  margin-top: 12px;
  border-radius: 12px;
  font-size: 17px;
  color: #0f2b43;
  font-weight: 600;
  box-shadow: 0 2px 12px rgba(0,0,0,0.15);
}

/* START AREA */
.startCard {
  display: none;
  background: #ffffff;
  padding: 40px 10px;
  margin-top: 25px;
  border-radius: 20px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.18);
}

.startTitle {
  font-weight: bold;
  font-size: 18px;
  margin-bottom: 25px;
}

.startCircle {
  width: 150px;
  height: 150px;
  border-radius: 999px;
  background: #f0f4f8;
  border: 10px solid #1d82c5;
  margin: 0 auto;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 22px;
  font-weight: bold;
  color: #0f2b43;
  cursor: pointer;
  box-shadow: 0 0 35px rgba(0,0,0,0.12);
}

/* Winner Box */
.winnerCard {
  display: none;
  background: #ffffff;
  padding: 25px 18px;
  margin-top: 22px;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.18);
  color: #0f2b43;
  text-align: center;
}

.trophy {
  font-size: 45px;
  margin-bottom: 10px;
}

.profilePic {
  width: 90px;
  height: 90px;
  border-radius: 999px;
  overflow: hidden;
  margin: 0 auto;
  border: 4px solid #1d82c5;
}

.profilePic img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.winnerName {
  margin-top: 10px;
  font-size: 19px;
  font-weight: bold;
}

.winnerName a {
  color: #0f2b43;
  text-decoration: none;
}

.winnerComment {
  font-size: 14px;
  margin-top: 8px;
  padding: 10px;
  background: #f4f8fb;
  border-radius: 8px;
  border: 1px solid #d4e1ec;
}

/* Pick New Winner Button */
.newBtn {
  width: 100%;
  background: #083b66;
  color: #fff;
  margin-top: 18px;
  padding: 12px;
  border-radius: 14px;
  font-size: 17px;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

.shuffleBox {
  font-size: 20px;
  font-weight: bold;
  margin-top: 12px;
  display: none;
  color: #fff;
}
</style>
</head>


<body>

<div class="container">

  <!-- LINK INPUT CARD -->
  <div class="box">
    <div class="boxTitle">YouTube Video Link</div>
    <input id="videoLink" type="text" placeholder="https://youtu.be/...">

    <div class="checkRow">
      <input id="filterDup" type="checkbox" checked>
      <label for="filterDup">Filter duplicate & bot comments</label>
    </div>

    <button class="bigBtn" onclick="loadComments()">LOAD UNIQUE COMMENTS</button>
  </div>

  <!-- COMMENT COUNT BOX -->
  <div id="commentCount" class="countBox"></div>

  <!-- START RAFFLE UI -->
  <div id="startCard" class="startCard">
    <div class="startTitle">START RAFFLE & PICK WINNER</div>
    <div class="startCircle" onclick="startRaffle()">START</div>
  </div>

  <!-- SHUFFLE NAMES -->
  <div id="shuffleBox" class="shuffleBox"></div>

  <!-- WINNER RESULT -->
  <div id="winnerCard" class="winnerCard">
    <div class="trophy">üèÜ</div>

    <div class="profilePic"><img id="winnerImg" src=""></div>

    <div id="winnerName" class="winnerName"></div>

    <div id="winnerComment" class="winnerComment"></div>

    <button class="newBtn" onclick="pickAnother()">PICK NEW WINNER</button>
  </div>

</div>


<script>
/* ---------------- BACKEND LINK ---------------- */
const BACKEND_URL =
"https://script.google.com/macros/s/AKfycbwrudRpmIP1rzMD79VpZUb1AYKs3Wxne1eD6FfBjWlPyyucpvgZ1mp8f3cb3xoN09SW/exec";

/* STATE */
let pool = [];
let currentVideoId = "";

/* Extract Video ID */
function extractVideoId(link){
  try {
    const u = new URL(link);
    if (u.searchParams.get("v")) return u.searchParams.get("v");
    if (u.hostname === "youtu.be") return u.pathname.slice(1);
    if (u.pathname.startsWith("/shorts/"))
      return u.pathname.split("/")[2];
  } catch(e){}
  return null;
}


/* ---------------- LOAD COMMENTS ---------------- */
async function loadComments(){
  const link = document.getElementById("videoLink").value.trim();
  const videoId = extractVideoId(link);
  const countBox = document.getElementById("commentCount");

  if(!videoId){
    alert("Invalid YouTube link");
    return;
  }

  currentVideoId = videoId;

  countBox.style.display = "block";
  countBox.innerHTML = "‚è≥ Loading comments‚Ä¶";

  try{
    const res = await fetch(`${BACKEND_URL}?videoId=${videoId}`);
    const data = await res.json();

    if(data.error){
      countBox.innerHTML = "‚ùå Error loading comments";
      return;
    }

    pool = data.pool || [];

    countBox.innerHTML =
      `Amount of comments: <strong>${data.uniqueUsers}</strong>`;

    document.getElementById("startCard").style.display = "block";

  }catch(err){
    countBox.innerHTML = "‚ùå Network error";
  }
}


/* ---------------- START SHUFFLING ---------------- */
function startRaffle(){
  const shuffle = document.getElementById("shuffleBox");
  const winnerCard = document.getElementById("winnerCard");

  shuffle.style.display = "block";
  shuffle.innerHTML = "";
  winnerCard.style.display = "none";

  let rounds = 35;
  let i = 0;

  const shuffler = setInterval(()=>{
    const r = pool[Math.floor(Math.random()*pool.length)];
    shuffle.innerHTML = r.author;
    i++;

    if(i >= rounds){
      clearInterval(shuffler);
      showWinner();
    }
  }, 80);
}


/* ---------------- SHOW WINNER ---------------- */
function showWinner(){
  const shuffle = document.getElementById("shuffleBox");
  shuffle.style.display = "none";

  const winnerCard = document.getElementById("winnerCard");
  winnerCard.style.display = "block";

  const final = pool[Math.floor(Math.random()*pool.length)];

  document.getElementById("winnerImg").src = final.profileImageUrl || "";
  document.getElementById("winnerName").innerHTML =
    `<a href="https://youtube.com/channel/${final.channelId}" target="_blank">@${final.author}</a>`;

  document.getElementById("winnerComment").innerHTML =
    final.comment || "";
}


/* ---------------- PICK NEW WINNER ---------------- */
function pickAnother(){
  showWinner();
}
</script>

</body>
</html>
