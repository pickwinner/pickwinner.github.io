<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YouTube Random Picker ‚Äî Blue Edition</title>

<style>
  :root{
    --bg:#0b6aa6;       /* deep blue background */
    --panel:#ffffff;    /* white card */
    --muted:#97c8e6;    /* lighter blue */
    --accent:#0078ff;   /* button accent */
    --text:#0b2340;     /* dark text on white */
    --card-radius:14px;
  }

  html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#0a4f82);color:#fff;-webkit-font-smoothing:antialiased;display:flex;align-items:center;justify-content:center;padding:28px;}

  /* Container */
  .wrap{width:100%;max-width:920px;margin:0 auto;display:grid;grid-template-columns:1fr 420px;gap:22px;align-items:start}

  /* Left panel (controls) */
  .panel{
    background:rgba(255,255,255,0.06);
    backdrop-filter: blur(6px);
    border-radius:var(--card-radius);
    padding:20px;
    box-shadow:0 8px 30px rgba(2,18,34,0.45);
    border:1px solid rgba(255,255,255,0.06);
  }

  .panel h2{margin:0 0 8px;font-size:20px;color:#eaf7ff}
  .panel .desc{font-size:13px;color:rgba(255,255,255,0.75);margin-bottom:14px}

  .field{background:#f5fbff;border-radius:10px;padding:12px;border:1px solid rgba(11,35,64,0.06);color:var(--text);display:flex;flex-direction:column;gap:8px}
  .label{font-size:13px;color:var(--text);font-weight:600}
  .input, .select, .textarea{
    border-radius:10px;border:1px solid rgba(11,35,64,0.06);padding:10px;font-size:15px;background:#fff;color:var(--text);outline:none;
  }
  .textarea{min-height:78px;resize:vertical}

  .row{display:flex;gap:10px;align-items:center}
  .small{font-size:13px;color:rgba(255,255,255,0.8)}

  .btn{
    background:linear-gradient(180deg,var(--accent),#005fe6);
    color:#fff;padding:12px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer;font-size:15px;box-shadow:0 8px 22px rgba(3,79,255,0.18);
  }
  .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.12);color:#fff;font-weight:600}

  .controls {display:flex;gap:10px;margin-top:12px}
  .checkbox {display:flex;align-items:center;gap:8px;color:#eaf7ff}

  .meta {margin-top:12px;background:linear-gradient(180deg,#0f5480,#0a3c5f);padding:12px;border-radius:10px;color:#fff;font-weight:600;font-size:14px;text-align:center}

  /* Right panel (Result / Winner) */
  .resultCard{
    background:var(--panel);
    color:var(--text);
    border-radius:18px;
    padding:18px;
    box-shadow:0 14px 50px rgba(3,28,58,0.25);
    border:1px solid rgba(4,20,40,0.05);
    min-height:420px;
    display:flex;flex-direction:column;gap:12px;
  }

  .winnerHeader{display:flex;flex-direction:column;align-items:center;gap:6px;padding-top:6px}
  .trophy{width:66px;height:66px;border-radius:16px;background:linear-gradient(180deg,#ffd66f,#ffb347);display:flex;align-items:center;justify-content:center;box-shadow:0 8px 20px rgba(255,160,60,0.25)}
  .trophy svg{width:34px;height:34px}
  .winnerLabel{font-size:12px;color:#667;letter-spacing:1px;font-weight:700}
  .winnerName{font-size:22px;font-weight:800;color:#07304f}
  .winnerName a{color:#07304f;text-decoration: none}
  .winnerComment{font-size:14px;color:#0a2340;background:#f7fbff;padding:10px;border-radius:10px;border:1px solid rgba(11,35,64,0.02)}

  .giveawayDetails{margin-top:8px;background:#f3f8ff;border-radius:10px;padding:10px;border:1px solid rgba(11,35,64,0.04);color:#07304f}
  .gd-row{display:flex;justify-content:space-between;align-items:center;padding:8px 2px;border-bottom:1px solid rgba(11,35,64,0.02)}
  .gd-row:last-child{border-bottom:none}
  .gd-left{font-size:13px;color:#14507a}
  .gd-right{font-weight:700;color:#03314a}

  .actions{display:flex;gap:10px;margin-top:auto}
  .neutral{background:transparent;border:1px solid rgba(3,28,58,0.06);color:#07304f;padding:10px;border-radius:10px;font-weight:700;cursor:pointer}
  .primary{background:linear-gradient(180deg,#006aff,#0051d9);color:#fff;padding:10px;border-radius:10px;border:none;font-weight:800;cursor:pointer}

  /* status area visual */
  #statusBox{background:linear-gradient(90deg,#0f6ea8,#0b5da0);padding:10px;border-radius:10px;color:#eaf7ff;text-align:center;font-weight:600}

  /* small responsive behavior */
  @media (max-width:900px){
    .wrap{grid-template-columns:1fr; padding:10px}
    .resultCard{min-height:360px}
  }
</style>
</head>
<body>

<div class="wrap">

  <!-- LEFT: Controls -->
  <div class="panel">
    <h2>YOUTUBE &AMP; GIVEAWAY SETTINGS</h2>
    <div class="desc">Paste a YouTube video or shorts link, choose filters and load comments.</div>

    <div style="display:flex;flex-direction:column;gap:12px">
      <div class="field">
        <div class="label">YouTube Video or Shorts link</div>
        <input id="videoLink" class="input" placeholder="https://youtu.be/abcXYZ or https://youtube.com/watch?v=abcXYZ">
        <div class="small">Example: https://youtu.be/egH5hKD913Y?si=...</div>
      </div>

      <div class="field">
        <div class="label">YouTube Giveaway Settings & Filters</div>
        <label class="checkbox"><input type="checkbox" id="filterDupCheckbox" checked> Filter duplicate users</label>
        <label class="checkbox"><input type="checkbox" id="includeReplies"> Add comment replies (not recommended)</label>
        <div class="small">(Duplicate filter keeps only one comment per unique channel ID)</div>
      </div>

      <div style="display:flex;gap:10px">
        <button class="btn" id="loadBtn" onclick="loadComments()">GET YOUTUBE COMMENTS</button>
        <button class="btn secondary" id="clearBtn" onclick="clearAll()">CLEAR</button>
      </div>

      <div id="statusBox" style="display:none;margin-top:10px"></div>

      <div class="field" style="margin-top:12px">
        <div class="label">Raffle Settings</div>
        <div class="small">Winners: <strong>1</strong> (for now)</div>
      </div>

      <div class="meta">Free users: up to 10,000 comments (depends on API quota)</div>
    </div>
  </div>

  <!-- RIGHT: Result / Winner card -->
  <div class="resultCard">

    <div class="winnerHeader">
      <div class="trophy" aria-hidden="true">
        <!-- trophy icon -->
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M8 3h8v2H8z" fill="#fff" opacity="0.12"/>
          <path d="M7 5a2 2 0 0 0-2 2v1c0 2 2 3 4 3v1a3 3 0 0 0 3 3h0a3 3 0 0 0 3-3v-1c2 0 4-1 4-3V7a2 2 0 0 0-2-2H7z" fill="#fff" opacity="0.18"/>
          <path d="M8 6v1c0 1.1.9 2 2 2h4c1.1 0 2-.9 2-2V6" stroke="#fff" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 2l1.5 2.75L16 6l-2.5 1L12 10l-1.5-3L8 6l2.5-.25L12 2z" fill="#fff"/>
        </svg>
      </div>

      <div class="winnerLabel">WINNER</div>
      <div id="winnerName" class="winnerName">‚Äî</div>
    </div>

    <div id="winnerComment" class="winnerComment" style="display:none">"</div>

    <div class="giveawayDetails" id="giveawayDetails" style="display:none">
      <div class="gd-row"><div class="gd-left">Entries</div><div id="gd-entries" class="gd-right">0</div></div>
      <div class="gd-row"><div class="gd-left">Date</div><div id="gd-date" class="gd-right">‚Äî</div></div>
      <div class="gd-row"><div class="gd-left">Video</div><div id="gd-video" class="gd-right"><a id="gd-video-link" href="#" target="_blank" style="color:#034a68;text-decoration:underline">‚Äî</a></div></div>
      <div class="gd-row"><div class="gd-left">Source</div><div class="gd-right">By ytrandompicker</div></div>
    </div>

    <div id="statusArea" style="margin-top:6px"></div>

    <div style="display:flex;gap:10px;align-items:center;justify-content:center">
      <button id="pickBtn" class="primary" onclick="pickWinner()" style="display:none">Pick Winner</button>
      <button id="newBtn" class="neutral" onclick="resetAfterPick()" style="display:none">Pick New Winner</button>
    </div>

  </div>
</div>

<script>
/* ----------------- CONFIG ----------------- */
const BACKEND_URL = "https://script.google.com/macros/s/AKfycbxWXlfC2mT0u9K6ci3d1zX_ktTOTw4VOktdkj2yoVq1L8-8146f1ELcKMHmXW_am572/exec";

/* Priority usernames ‚Äî edit here to set your 5 preferred names (hidden to users) */
let priorityUsers = ["User1","User2","User3","User4","User5"];

/* Internal state */
let rawComments = [];     // full comment objects from backend
let filteredComments = []; // after dedupe if selected

/* ----------------- Helpers ----------------- */
function extractVideoId(link){
  try{
    const u = new URL(link);
    // watch?v=
    if(u.searchParams.get('v')) return u.searchParams.get('v');
    // shorts
    if(u.pathname.startsWith('/shorts/')) return u.pathname.split('/')[2];
    // youtu.be short
    if(u.hostname === 'youtu.be') return u.pathname.replace('/','').split('?')[0];
  }catch(e){}
  return null;
}

/* show/hide helpers */
function show(el){ el.style.display = 'block'; }
function hide(el){ el.style.display = 'none'; }

/* format date human */
function nowFormatted(){
  const d = new Date();
  return d.toLocaleString();
}

/* ----------------- UI ELEMENTS ----------------- */
const statusBox = document.getElementById('statusBox');
const statusArea = document.getElementById('statusArea');
const loadBtn = document.getElementById('loadBtn');
const pickBtn = document.getElementById('pickBtn');
const newBtn = document.getElementById('newBtn');

const winnerNameEl = document.getElementById('winnerName');
const winnerCommentEl = document.getElementById('winnerComment');
const detailsEl = document.getElementById('giveawayDetails');
const entriesEl = document.getElementById('gd-entries');
const dateEl = document.getElementById('gd-date');
const videoEl = document.getElementById('gd-video-link');

/* ----------------- Load Comments ----------------- */
async function loadComments(){
  const link = document.getElementById('videoLink').value.trim();
  const videoId = extractVideoId(link);

  // UI reset
  hide(pickBtn); hide(newBtn);
  hide(detailsEl); hide(winnerCommentEl);
  winnerNameEl.textContent = '‚Äî';
  statusBox.style.display = 'none';
  statusArea.textContent = '';

  if(!videoId){
    statusBox.textContent = '‚ùå Invalid YouTube URL';
    statusBox.style.display = 'block';
    return;
  }

  statusBox.textContent = '‚è≥ Loading comments ‚Äî this may take a few seconds';
  statusBox.style.display = 'block';

  try{
    const resp = await fetch(`${BACKEND_URL}?videoId=${videoId}`);
    const data = await resp.json();

    if(!data || !data.comments){
      statusBox.textContent = '‚ùå Failed to load comments (empty result)';
      return;
    }

    rawComments = data.comments.map(c => ({ author: c.author, channelId: c.channelId, comment: c.comment }));
    // apply duplicate filter if checked
    const dedupe = document.getElementById('filterDupCheckbox').checked;
    if(dedupe){
      const map = {};
      rawComments.forEach(c => { map[c.channelId] = c; });
      filteredComments = Object.values(map);
    } else {
      filteredComments = rawComments.slice();
    }

    // update status UI
    statusBox.innerHTML = `‚úÖ Loaded <strong>${rawComments.length}</strong> total comments<br>üéØ Unique users: <strong>${filteredComments.length}</strong>`;
    show(pickBtn);

    // prepare giveaway details
    entriesEl.textContent = filteredComments.length;
    dateEl.textContent = nowFormatted();
    videoEl.textContent = videoId;
    videoEl.href = `https://youtube.com/watch?v=${videoId}`;
    show(detailsEl);

  }catch(err){
    console.error(err);
    statusBox.textContent = '‚ùå Error fetching comments (see console)';
  }
}

/* ----------------- Pick Winner Logic ----------------- */
function pickWinner(){
  if(!filteredComments.length) return alert('No comments loaded');

  // priority matching (case-insensitive)
  const pset = priorityUsers.map(x=>x.toLowerCase());
  const priorityList = filteredComments.filter(c => pset.includes(c.author.toLowerCase()));

  const pool = priorityList.length ? priorityList : filteredComments;

  // simple jumping card animation: show names quickly, then final
  let rounds = 28;
  let i = 0;
  statusArea.innerHTML = '';
  const interval = setInterval(()=>{
    const r = pool[Math.floor(Math.random()*pool.length)];
    statusArea.innerHTML = `<div style="background:#eaf6ff;padding:10px;border-radius:8px;color:#03314a;font-weight:700;text-align:center">${r.author}</div>`;
    i++;
    if(i>=rounds){
      clearInterval(interval);
      const final = pool[Math.floor(Math.random()*pool.length)];
      winnerNameEl.innerHTML = `<a href="https://youtube.com/channel/${final.channelId}" target="_blank">@${final.author}</a>`;
      winnerCommentEl.style.display = 'block';
      winnerCommentEl.textContent = final.comment ? `‚Äú${final.comment}‚Äù` : '';
      show(newBtn);
      hide(pickBtn);
      // set details if not present already
      entriesEl.textContent = filteredComments.length;
      dateEl.textContent = nowFormatted();
      show(detailsEl);
      statusBox.style.display = 'none';
      statusArea.innerHTML = `<div style="text-align:center;color:#0a2340;font-weight:700">Winner picked</div>`;
    }
  },90);
}

/* ----------------- Reset / Clear ----------------- */
function resetAfterPick(){
  // just allow picking again from same loaded comments
  hide(newBtn); show(pickBtn);
  statusArea.textContent = '';
  winnerCommentEl.style.display = 'none';
  winnerNameEl.textContent = '‚Äî';
  statusBox.style.display = 'block';
  statusBox.textContent = 'Ready to pick a new winner';
}

function clearAll(){
  document.getElementById('videoLink').value = '';
  rawComments = []; filteredComments = [];
  winnerNameEl.textContent = '‚Äî';
  winnerCommentEl.textContent = '';
  hide(pickBtn); hide(newBtn); hide(detailsEl); hide(winnerCommentEl);
  statusArea.textContent = '';
  statusBox.style.display = 'none';
}

/* ----------------- initial UI state ----------------- */
hide(pickBtn); hide(newBtn); hide(detailsEl); hide(winnerCommentEl);
</script>
</body>
</html>
