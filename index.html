<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Comment Picker ‚Äî Premium Blue Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --blue-bg:#0b6aa6;
  --blue-dark:#0a4f82;
  --panel:#ffffff;
  --accent:#0078ff;
  --text-dark:#0a2340;
  --muted:#6a93af;
}

body{
  margin:0;
  font-family:Inter,Arial,sans-serif;
  background:linear-gradient(180deg,var(--blue-bg),var(--blue-dark));
  color:#fff;
  padding:25px;
  display:flex;
  justify-content:center;
}

.container{
  width:100%;
  max-width:980px;
  display:grid;
  grid-template-columns:1fr 420px;
  gap:22px;
}

.card{
  background:rgba(255,255,255,0.08);
  padding:20px;
  border-radius:14px;
  backdrop-filter:blur(6px);
  box-shadow:0 10px 30px rgba(0,0,0,0.35);
}

.card h2{
  margin:0 0 8px;
  font-size:20px;
  font-weight:700;
}

.label{
  font-size:14px;
  color:#eaf7ff;
  margin-bottom:6px;
  font-weight:600;
}

.input{
  width:100%;
  padding:12px;
  font-size:16px;
  border-radius:10px;
  border:none;
  margin-bottom:12px;
  background:#f5fbff;
  color:#0a2340;
}

.button{
  padding:12px;
  text-align:center;
  width:100%;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:700;
  font-size:15px;
  background:linear-gradient(180deg,var(--accent),#005ae0);
  color:#fff;
  margin-top:10px;
}

.button.secondary{
  background:rgba(255,255,255,0.18);
  border:1px solid rgba(255,255,255,0.25);
}

.statusBox{
  display:none;
  background:linear-gradient(180deg,#0f6ea8,#0b5da0);
  padding:10px;
  border-radius:10px;
  margin-top:12px;
  text-align:center;
  font-weight:600;
}

.checkboxRow{
  display:flex;
  gap:8px;
  align-items:center;
  margin:8px 0;
}

.result{
  background:var(--panel);
  color:var(--text-dark);
  border-radius:18px;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:12px;
  box-shadow:0 12px 40px rgba(0,0,0,0.25);
}

.trophy{
  width:64px;
  height:64px;
  border-radius:16px;
  background:linear-gradient(180deg,#ffd66f,#ffb347);
  margin:0 auto;
  display:flex;
  align-items:center;
  justify-content:center;
}

.winnerName{
  font-size:20px;
  font-weight:800;
  text-align:center;
  color:#07304f;
}

.winnerName a{
  color:#07304f;
  text-decoration:none;
}

.winnerComment{
  font-size:14px;
  background:#f7fbff;
  padding:12px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,0.08);
}

.winnerPic{
  width:80px;
  height:80px;
  border-radius:50%;
  overflow:hidden;
  margin:0 auto;
  box-shadow:0 4px 12px rgba(0,0,0,0.25);
}

.winnerPic img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.details{
  background:#f3f8ff;
  border-radius:10px;
  padding:10px;
  border:1px solid rgba(0,0,0,0.08);
}

.dRow{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  border-bottom:1px solid rgba(0,0,0,0.06);
}

.dRow:last-child{
  border:none;
}

.actionRow{
  display:flex;
  gap:12px;
  margin-top:auto;
  justify-content:center;
}

.primary{
  background:linear-gradient(180deg,#006aff,#0051d9);
  color:#fff;
  padding:12px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:800;
}

.neutral{
  background:transparent;
  border:1px solid rgba(0,0,0,0.1);
  padding:12px 14px;
  color:#07304f;
  border-radius:10px;
  cursor:pointer;
  font-weight:700;
}

.randomFlash{
  font-size:18px;
  background:#eaf6ff;
  color:#03314a;
  padding:10px;
  border-radius:8px;
  text-align:center;
  margin-top:6px;
}
</style>
</head>
<body>

<div class="container">

  <!-- LEFT PANEL -->
  <div class="card">
    <h2>YouTube Comment Picker Settings</h2>

    <div class="label">Paste YouTube Link</div>
    <input id="videoLink" class="input" placeholder="https://youtu.be/xxxx or https://youtube.com/watch?v=xxxx">

    <div class="checkboxRow">
      <input type="checkbox" id="filterDup" checked>
      <label for="filterDup">Filter Duplicate Users</label>
    </div>

    <button class="button" onclick="loadComments()">Load All Comments</button>
    
    <div id="statusBox" class="statusBox"></div>

    <button id="pickBtn" class="button" onclick="pickWinner()" style="display:none;">Pick Winner</button>

  </div>

  <!-- RIGHT PANEL -->
  <div class="result">

    <div class="trophy">
      üèÜ
    </div>

    <div class="winnerPic" id="winnerPic" style="display:none;">
      <img id="winnerImg" src="">
    </div>

    <div class="winnerName" id="winnerName">‚Äî</div>

    <div class="winnerComment" id="winnerComment" style="display:none;"></div>

    <div class="details" id="detailsBox" style="display:none;">
      <div class="dRow"><span>Entries</span><span id="dEntries">0</span></div>
      <div class="dRow"><span>Date</span><span id="dDate">‚Äî</span></div>
      <div class="dRow"><span>Video</span><a id="dVideo" href="#" target="_blank">Open</a></div>
    </div>

    <div id="flashArea"></div>

    <div class="actionRow">
      <button id="newBtn" class="neutral" onclick="resetWinner()" style="display:none;">Pick New Winner</button>
    </div>

  </div>

</div>

<script>
const BACKEND_URL = "https://script.google.com/macros/s/AKfycbxWXlfC2mT0u9K6ci3d1zX_ktTOTw4VOktdkj2yoVq1L8-8146f1ELcKMHmXW_am572/exec";

let pool = [];               // backend secret pool for picking winners
let videoIdForDisplay = "";  // for details box

function extractVideoId(link){
  try{
    let u = new URL(link);
    if(u.searchParams.get("v")) return u.searchParams.get("v");
    if(u.hostname==="youtu.be") return u.pathname.replace("/","");
    if(u.pathname.startsWith("/shorts/")) return u.pathname.split("/")[2];
  }catch(e){}
  return null;
}

async function loadComments(){
  const link = document.getElementById("videoLink").value.trim();
  const box = document.getElementById("statusBox");
  const pickBtn = document.getElementById("pickBtn");

  let vid = extractVideoId(link);
  videoIdForDisplay = vid;

  if(!vid){
    box.style.display="block";
    box.textContent="‚ùå Invalid YouTube URL";
    return;
  }

  box.style.display="block";
  box.textContent="‚è≥ Loading comments‚Ä¶";

  try{
    let res = await fetch(`${BACKEND_URL}?videoId=${vid}`);
    let data = await res.json();

    if(data.error){
      box.textContent="‚ùå Error loading comments.";
      return;
    }

    // REAL visuals ‚Äî show totals, not secret numbers
    box.innerHTML = `‚úÖ Loaded <strong>${data.totalComments}</strong> comments<br>üéØ Unique users: <strong>${data.uniqueUsers}</strong>`;

    // The secret pool to pick from
    pool = data.pool || [];

    document.getElementById("dEntries").textContent = data.uniqueUsers;
    document.getElementById("dDate").textContent = new Date().toLocaleString();
    document.getElementById("dVideo").href = `https://youtube.com/watch?v=${vid}`;

    document.getElementById("detailsBox").style.display="block";

    pickBtn.style.display="block";

  }catch(err){
    box.textContent="‚ùå Error fetching comments.";
  }
}

function pickWinner(){
  if(pool.length === 0){
    alert("No comments to pick from.");
    return;
  }

  const flash = document.getElementById("flashArea");
  const pickBtn = document.getElementById("pickBtn");
  const newBtn = document.getElementById("newBtn");

  pickBtn.style.display="none";
  flash.innerHTML="";

  let rounds = 25;
  let count = 0;

  let interval = setInterval(()=>{
    let r = pool[Math.floor(Math.random()*pool.length)];
    flash.innerHTML = `<div class='randomFlash'>${r.author}</div>`;
    count++;

    if(count >= rounds){
      clearInterval(interval);

      let winner = pool[Math.floor(Math.random()*pool.length)];

      document.getElementById("winnerName").innerHTML = `<a href="https://youtube.com/channel/${winner.channelId}" target="_blank">@${winner.author}</a>`;
      document.getElementById("winnerComment").style.display="block";
      document.getElementById("winnerComment").textContent = winner.comment || "";

      if(winner.profileImageUrl){
        document.getElementById("winnerImg").src = winner.profileImageUrl;
        document.getElementById("winnerPic").style.display="block";
      }

      newBtn.style.display="block";
      flash.innerHTML = "";
    }

  },100);
}

function resetWinner(){
  document.getElementById("winnerName").textContent="‚Äî";
  document.getElementById("winnerComment").style.display="none";
  document.getElementById("winnerPic").style.display="none";
  document.getElementById("flashArea").innerHTML="";
  document.getElementById("newBtn").style.display="none";
  document.getElementById("pickBtn").style.display="block";
}
</script>

</body>
</html>
